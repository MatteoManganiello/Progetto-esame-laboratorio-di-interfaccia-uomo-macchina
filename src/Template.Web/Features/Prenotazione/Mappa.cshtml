@{
    ViewData["Title"] = "Planimetria Ufficio";
}

@section Scripts {
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        window.dashboardData = @Json.Serialize(ViewBag.DashboardData);
    </script>
    
    <script src="~/js/prenotazione.js" asp-append-version="true"></script>
}

@section styles {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="~/css/seatmap.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/sidebar.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/faqcard.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/infocards.css" asp-append-version="true" />

}


<div id="app-prenotazione" class="container-fluid py-4">

    <div class="mb-4">
        <partial name="_StatsCards" />
    </div>


    <div class="d-flex justify-content-between align-items-center mb-3">

        <div class="d-flex gap-2">
            <a href="#faq-section"
                class="btn btn-info text-white border shadow-sm px-3 rounded d-flex align-items-center gap-2"
                style="min-width: 110px; height: 48px; justify-content: center;">
                <i class="fa-solid fa-book-open"></i>
                <span class="d-none d-md-inline fw-bold">Guida, leggi prima di iniziare con la prenotazione</span>
            </a>

            <a href="#faq-section" class="btn border shadow-sm px-3 rounded d-flex align-items-center gap-2 text-white"
                style="background-color: #6f42c1; border-color: #6f42c1; min-width: 110px; height: 48px; justify-content: center;">
                <i class="fa-solid fa-circle-question"></i>
                <span class="d-none d-md-inline fw-bold">FAQ</span>
            </a>
        </div>

        <div class="bg-primary px-3 rounded border shadow-sm d-flex align-items-center" style="height: 48px;">

            <span class="text-white fw-bold small text-uppercase me-2" style="white-space: nowrap;">
                Scegli data:
            </span>

            <input type="date" class="form-control border-0 fw-bold p-1 text-center"
                style="outline: none; box-shadow: none; width: 130px; background-color: rgba(255,255,255,0.9);"
                v-model="dataSelezionata" v-on:change="caricaDatiMappa">
        </div>

    </div>


    <div class="row g-4">

        <div class="col-lg-9">
            <div class="map-card">
                <div class="map-area" style="position: relative; height: 100%;">

                    <div v-if="tooltip.visibile" class="custom-tooltip"
                        :style="{ top: tooltip.y + 'px', left: tooltip.x + 'px' }">

                        <div class="fw-bold text-warning mb-2"
                            style="font-size: 0.95rem; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px;">
                            {{ tooltip.dati.nome }}
                        </div>

                        <div class="tooltip-row mb-2">
                            <span class="badge bg-light text-dark border" style="font-size:0.7em">{{ tooltip.dati.tipo
                                }}</span>

                            <span v-if="tooltip.dati.tipo === 'Ristorante'">
                                <i class="fa-solid fa-utensils text-info"></i> {{ tooltip.dati.postiOccupati }}/{{
                                tooltip.dati.postiTotali }}
                            </span>
                            <span v-else>
                                <span v-if="tooltip.dati.isOccupata" class="text-danger fw-bold">
                                    <i class="fa-solid fa-xmark"></i> Occupato
                                </span>
                                <span v-else class="text-success fw-bold">
                                    <i class="fa-solid fa-check"></i> Libero
                                </span>
                            </span>
                        </div>

                        <div v-if="tooltip.dati.metriQuadri || tooltip.dati.descrizione || tooltip.dati.haProiettore"
                            class="mt-2 pt-2 text-light opacity-75 small"
                            style="border-top: 1px dashed rgba(255,255,255,0.2);">

                            <div v-if="tooltip.dati.metriQuadri" class="d-flex align-items-center gap-2 mb-1">
                                <i class="fa-solid fa-ruler-combined"></i>
                                <span>{{ tooltip.dati.metriQuadri }} mÂ²</span>
                            </div>

                            <div v-if="tooltip.dati.haProiettore || tooltip.dati.haFinestre || tooltip.dati.haledwall || tooltip.dati.haArmadietto"
                                class="d-flex flex-column gap-1 mt-1 align-items-start">

                                <span v-if="tooltip.dati.haledwall" title="Ledwall">
                                    <i class="fa-solid fa-video me-1"></i> LED WALL
                                </span>

                                <span v-if="tooltip.dati.haProiettore" title="Lavagna">
                                    <i class="fa-solid fa-video me-1"></i> LAVAGNA INTERATTIVA
                                </span>

                                <span v-if="tooltip.dati.haFinestre" title="Luce Naturale">
                                    <i class="fa-regular fa-sun me-2"></i> Finestra
                                </span>

                                <span v-if="tooltip.dati.haArmadietto" title="locker">
                                    <i class="fa-solid fa-lock me-2"></i> Armadietto (Locker)
                                </span>
                            </div>
                            <div v-if="tooltip.dati.descrizione" class="mt-2 fst-italic text-white-50"
                                style="white-space: normal; max-width: 200px; line-height: 1.2;">
                                {{ tooltip.dati.descrizione }}
                            </div>
                        </div>
                    </div>

                    <div v-if="loading" class="d-flex justify-content-center align-items-center h-100">
                        <div class="spinner-border text-primary"></div>
                    </div>

                    <svg v-else viewBox="0 0 1000 600" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <path id="office-chair"
                                d="M4,18 C4,20 16,20 16,18 L16,14 C16,8 4,8 4,14 Z M2,14 C2,6 18,6 18,14 L18,16 C20,16 20,20 18,20 L2,20 C0,20 0,16 2,16 Z"
                                class="chair-shape" />
                        </defs>

                        <image href="/images/piantina-base.png" x="0" y="0" width="1000" height="600"
                            preserveAspectRatio="none" style="opacity: 0.6; filter: grayscale(30%);" />

                        <text x="850" y="520" class="map-label" transform="rotate(90, 960, 300)"
                            style="font-size:18px">DESK
                            ROOM</text>
                        <text x="850" y="800" class="map-label" transform="rotate(90, 960, 300)"
                            style="font-size:18px">SALA
                            EVENTI</text>
                        <text x="700" y="380" class="map-label">MEETING</text>
                        <text x="310" y="380" class="map-label">DEV TEAM</text>
                        <text x="513" y="380" class="map-label">DEV TEAM</text>
                        <text x="103" y="380" class="map-label">MEETING</text>
                        <text x="960" y="300" class="map-label" transform="rotate(90, 960, 300)"
                            style="font-size:18px">RISTORANTE</text>

                        <g v-for="p in postazioni" :key="p.id" class="seat-group"
                            :class="getStatoClasse(p) + ' type-' + p.tipo.toLowerCase()"
                            v-on:click="selezionaPostazione(p)" @@mouseenter="mostraTooltip(p, $event)"
                            @@mousemove="muoviTooltip($event)" @@mouseleave="nascondiTooltip">

                            <g v-if="p.tipo === 'Singola'">
                                <use href="#office-chair" :x="p.x+5" :y="p.y+20" />
                                <rect :x="p.x" :y="p.y" :width="p.width" :height="p.height" rx="3" class="desk-shape" />
                            </g>
                            <g v-else-if="p.tipo === 'Team'">
                                <rect :x="p.x" :y="p.y" :width="p.width" :height="p.height" rx="6" class="desk-shape" />
                                <text :x="p.x + p.width/2" :y="p.y + p.height/2 + 5" font-size="12" fill="#adb5bd"
                                    text-anchor="middle" font-weight="bold" style="pointer-events:none">TEAM</text>
                                <use href="#office-chair" :x="p.x+20" :y="p.y-20"
                                    :transform="`rotate(180, ${p.x+30}, ${p.y-10})`" />
                                <use href="#office-chair" :x="p.x+p.width/2-10" :y="p.y-20"
                                    :transform="`rotate(180, ${p.x+p.width/2}, ${p.y-10})`" />
                                <use href="#office-chair" :x="p.x+p.width-40" :y="p.y-20"
                                    :transform="`rotate(180, ${p.x+p.width-30}, ${p.y-10})`" />
                                <use href="#office-chair" :x="p.x+20" :y="p.y+p.height" />
                                <use href="#office-chair" :x="p.x+p.width/2-10" :y="p.y+p.height" />
                                <use href="#office-chair" :x="p.x+p.width-40" :y="p.y+p.height" />
                            </g>
                            <g v-else-if="p.tipo === 'Riunioni'">
                                <rect :x="p.x" :y="p.y" :width="p.width" :height="p.height" rx="20"
                                    class="desk-shape" />
                                <text :x="p.x + p.width/2" :y="p.y + p.height/2 + 5" font-size="11" fill="#adb5bd"
                                    text-anchor="middle" font-weight="bold" style="pointer-events:none">MEET</text>
                                <use href="#office-chair" :x="p.x+20" :y="p.y-20"
                                    :transform="`rotate(180, ${p.x+30}, ${p.y-10})`" />
                                <use href="#office-chair" :x="p.x+p.width/2-10" :y="p.y-20"
                                    :transform="`rotate(180, ${p.x+p.width/2}, ${p.y-10})`" />
                                <use href="#office-chair" :x="p.x+p.width-40" :y="p.y-20"
                                    :transform="`rotate(180, ${p.x+p.width-30}, ${p.y-10})`" />
                                <use href="#office-chair" :x="p.x+20" :y="p.y+p.height" />
                                <use href="#office-chair" :x="p.x+p.width/2-10" :y="p.y+p.height" />
                                <use href="#office-chair" :x="p.x+p.width-40" :y="p.y+p.height" />
                            </g>
                            <g v-else-if="p.tipo === 'Eventi'">
                                <rect :x="p.x" :y="p.y + 10" width="350" height="30" fill="#343a40" rx="2" />
                                <text :x="p.x + 175" :y="p.y + 30" font-size="12" fill="white" text-anchor="middle"
                                    font-weight="bold" style="pointer-events:none; letter-spacing: 1px;">LED WALL</text>
                                <rect :x="p.x" :y="p.y+60" :width="p.width" :height="p.height-60" fill="white"
                                    class="platea-shape" rx="4" />
                                <text :x="p.x + p.width/2" :y="p.y + p.height/2 + 30" font-size="14" fill="#adb5bd"
                                    text-anchor="middle" font-weight="bold">PLATEA</text>
                            </g>
                            <g v-else-if="p.tipo === 'Ristorante'">
                                <use href="#office-chair" :x="p.x + 30" :y="p.y - 20"
                                    :transform="`rotate(180, ${p.x + 30}, ${p.y - 10})`" />
                                <use href="#office-chair" :x="p.x + 70" :y="p.y - 20"
                                    :transform="`rotate(180, ${p.x + 80}, ${p.y - 10})`" />
                                <use href="#office-chair" :x="p.x + 10" :y="p.y + p.height" />
                                <use href="#office-chair" :x="p.x + 70" :y="p.y + p.height" />
                                <rect :x="p.x" :y="p.y" :width="p.width" :height="p.height" rx="4" class="desk-shape" />
                                <text :x="p.x + p.width/2" :y="p.y + p.height/2 + 5" text-anchor="middle" font-size="12"
                                    fill="#adb5bd" font-weight="bold" style="pointer-events:none">
                                    {{ p.postiTotali - p.postiOccupati }}/{{ p.postiTotali }}
                                </text>
                            </g>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="sidebar-card">
                <partial name="Sidebar" />
            </div>
        </div>
    </div>

    <div class="mt-4">
        <partial name="_InfoCards" />
    </div>
    <div id="faq-section">
        <partial name="_FaqCard" />
    </div>

</div>
